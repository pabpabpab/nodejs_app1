<html>

<head>
    <title>Messenger</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"
            integrity="sha384-/KNQL8Nu5gCHLqwqfQjA689Hhoqgi2S84SNUxC3roTe4EhJ9AfLkp8QiQcU8AMzI"
            crossorigin="anonymous"></script>
</head>

<body>
<h1>Messenger</h1>
<input type="text" id="textInput" autofocus/>
<input type="submit" id="sendBtn" value="Send" />
<div id="messages"></div>

<script>
    let userNick = undefined;

    const socket = io('localhost:3000');

    socket.on('connect', () => console.log('Connection with localhost:3000 created'));

    socket.on('server-msg', ({ nick, msg }) => {
        userNick = userNick ?? nick;
        const msgSpan = document.createElement('span').innerHTML = `${nick}: ${msg}`;
        document.getElementById('messages').append(msgSpan);
        document.getElementById('messages').append(document.createElement('br'));
    });

    socket.on('reconnect', () => {
        console.log('you have been reconnected');
        // where userNick is a global variable for the client
        socket.emit('client-reconnected', userNick);
    });

    document.getElementById('sendBtn').onclick = function () {
        socket.emit('client-msg', { msg: document.getElementById('textInput').value })
        document.getElementById('textInput').value = '';
    };
</script>
</body>
</html>